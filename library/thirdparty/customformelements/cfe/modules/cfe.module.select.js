cfe.module.select=new Class({Extends:cfe.generic,Binds:["wheelListener","clickedOutsideListener"],instance:0,type:"Selector",selector:"select:not(select[multiple])",options:{size:4,scrolling:true,scrollSteps:5},initializeAdv:function(){this.parent();this.hideOriginal();this.o.addEvent("keyup",this.keyup.bind(this));
this.o.addEvent("keydown",this.keydown.bind(this));this.origOptions=this.o.getChildren();this.selectedIndex=this.o.selectedIndex||0;this.kind=[];if(this.options.size>this.origOptions.length||this.options.scrolling!=true){this.options.size=this.origOptions.length;}},createOriginal:function(){var b=new Element("select");
if($chk(this.options.options)){for(var a in this.options.options){b.adopt(new Element("option",{value:a,selected:this.options.options[a].selected?"selected":""}).set("html",this.options.options[a].label));}}return b;},build:function(){this.arrow=new Element("img",{"class":"js"+this.type+"Arrow","src":this.options.spacer,"styles":{"float":"right","display":"inline"}}).injectInside(this.a);
this.ai=new Element("span").addClass("js"+this.type+"Slide").injectInside(this.a).adopt(this.arrow);this.activeEl=new Element("span",{"class":"jsOptionSelected","styles":{"float":"left","display":"inline"}}).set("html",this.origOptions[0].get("text")).injectBefore(this.arrow);this.buildContainer();this.selectOption(this.selectedIndex,false,true);
},buildOption:function(b,a){var c=new Element("div",{"class":"jsOption jsOption"+a+(b.get("class")?" "+b.get("class"):""),"events":{"mouseover":this.highlightOption.pass([a,true],this),"mouseout":this.highlightOption.pass([a,true],this)}}).set("html",b.innerHTML);c.index=a;c.disableTextSelection();return c;
},setupScrolling:function(){this.scrollerWrapper=new Element("div",{"class":"js"+this.type+"ScrollerWrapper","styles":{height:this.gfxHeight}}).injectInside(this.cContent);this.scrollerTop=$(new cfe.generic()).addClass("scrollTop").addEvent("click",function(a){this.moveScroller.pass(-1*this.options.scrollSteps,this)();
}.bind(this));this.scrollerBottom=$(new cfe.generic()).addClass("scrollBottom").addEvent("click",function(a){this.moveScroller.pass(this.options.scrollSteps,this)();}.bind(this));this.scrollerKnob=new Element("span",{"class":"scrollKnob spc"});this.scrollerBack=new Element("div");this.scrollerBack.adopt(this.scrollerKnob);
this.scrollerWrapper.adopt([this.scrollerTop,this.scrollerBack,this.scrollerBottom]);this.scrollerBack.setStyle("height",this.gfxHeight-2*this.scrollerTop.getFirst().getHeight());this.sliderSteps=this.aliasOptions.getScrollSize().y-(this.options.size*this.aliasOptions.getScrollSize().y/this.aOptions.length);
this.slider=new Slider(this.scrollerBack,this.scrollerKnob,{steps:this.sliderSteps,mode:"vertical",onChange:function(a){this.aliasOptions.scrollTo(false,a);}.bind(this)}).set(0);},buildContainer:function(){this.container=new Element("div",{"class":"js"+this.type+"Container","styles":{"overflow":"hidden"}});
this.container.setSlidingDoors(4,"div","jsSelectorContent").injectInside(this.a);this.cContent=this.container.getParent();this.containerSlide=this.cContent.getParents(".jsSelectorContentSlide1")[0];this.aliasOptions=this.container;if(this.cContent.getStyle("width").toInt()===0){var a=true;}this.origOptions.each(function(c,b){this.buildOption(c,b).inject(this.aliasOptions);
}.bind(this));this.aOptions=this.aliasOptions.getChildren();this.gfxHeight=this.aOptions[0].getHeight()*this.options.size;this.gfxWidth=this.cContent.getWidth()-(this.cContent.getStyle("padding-left")).toInt()-this.cContent.getStyle("padding-right").toInt();if(this.options.scrolling){this.setupScrolling();
this.gfxWidth=this.gfxWidth-this.scrollerWrapper.getWidth();}if(this.gfxHeight!=0){this.aliasOptions.setStyle("height",this.gfxHeight);}if(this.gfxWidth!=0&&!a){this.aliasOptions.setStyle("width",this.gfxWidth);}},selectOption:function(b,a,c){b=b.limit(0,this.origOptions.length-1);this.highlightOption(b,c);
this.selectedIndex=b;this.activeEl.set("html",(this.aOptions[b]).innerHTML);if(!$chk(a)){this.hideContainer();}},highlightOption:function(a,b){a=a.limit(0,this.origOptions.length-1);if(this.highlighted){this.highlighted.removeClass("H");}this.highlighted=this.aOptions[a].addClass("H");this.highlightedIndex=a;
if(!b){this.scrollToSelectedItem(this.highlightedIndex);}},scrollToSelectedItem:function(a){if(this.options.scrolling){this.slider.set((this.sliderSteps/(this.aOptions.length-this.options.size))*a);}},moveScroller:function(b){var a=this.aliasOptions.getScroll().y;this.slider.set(a+b<this.sliderSteps?a+b:this.sliderSteps);
},hideContainer:function(){$(document.body).removeEvent("mousewheel",this.wheelListener);$(document.body).removeEvent("click",this.clickedOutsideListener);this.containerSlide.setStyle("display","none");this.isShown=false;},showContainer:function(){$(document.body).addEvent("mousewheel",this.wheelListener);
$(document.body).addEvent("click",this.clickedOutsideListener);this.containerSlide.setStyles({display:"block",position:"absolute",top:this.a.getTop(),left:this.a.getLeft(),"z-index":1000-this.instance});this.isShown=true;this.highlightOption(this.o.selectedIndex);},clicked:function(b){if(!this.isDisabled()){if($defined(b.target)){var a=$(b.target);
if(a.getParent()==this.aliasOptions){this.selectOption(a.index,true,true);this.hideContainer();this.parent();this.o.selectedIndex=a.index;this.o.fireEvent("change");return;}else{if(this.options.scrolling&&a.getParents("."+this.scrollerWrapper.getProperty("class"))[0]==this.scrollerWrapper){return;}}}this.toggle();
this.parent();}},toggle:function(){$chk(this.isShown)?this.hideContainer():this.showContainer();},keyup:function(a){if(a.alt&&(a.key=="up"||a.key=="down")){this.toggle();return;}switch(a.key){case"enter":case"space":this.toggle();break;case"up":this.updateOption(-1);break;case"down":this.updateOption(1);
break;case"esc":this.hideContainer();break;default:this.o.fireEvent("change");break;}},keydown:function(a){if(a.key=="tab"){this.hideContainer();}},wheelListener:function(a){a.stop();this.updateOption(-1*a.wheel);},updateOption:function(a){this.o.selectedIndex=(this.highlightedIndex+a).limit(0,this.origOptions.length-1);
this.o.fireEvent("change");},clickedOutsideListener:function(a){if($(a.target).getParent(".js"+this.type)!=this.a&&!((Browser.Engine.trident||(Browser.Engine.presto&&Browser.Engine.version>950))&&a.target==this.o)&&(!$chk(this.l)||(this.l&&$(a.target)!=this.l))){this.hideContainer();}},update:function(){this.parent();
this.selectOption(this.o.selectedIndex,true);}});