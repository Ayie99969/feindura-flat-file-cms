CKEDITOR.dialog.add("link",function(l){var i=CKEDITOR.plugins.link;var y=function(){var F=this.getDialog(),E=F.getContentElement("target","popupFeatures"),G=F.getContentElement("target","linkTargetName"),H=this.getValue();if(!E||!G){return;}E=E.getElement();E.hide();G.setValue("");switch(H){case"frame":G.setLabel(l.lang.link.targetFrameName);G.getElement().show();break;case"popup":E.show();G.setLabel(l.lang.link.targetPopupName);G.getElement().show();break;default:G.setValue(H);G.getElement().hide();break;}};var C=function(){var H=this.getDialog(),K=["urlOptions","anchorOptions","emailOptions"],J=this.getValue(),I=H.definition.getContents("upload"),E=I&&I.hidden;if(J=="url"){if(l.config.linkShowTargetTab){H.showPage("target");}if(!E){H.showPage("upload");}}else{H.hidePage("target");if(!E){H.hidePage("upload");}}for(var G=0;G<K.length;G++){var F=H.getContentElement("info",K[G]);if(!F){continue;}F=F.getElement().getParent().getParent();if(K[G]==J+"Options"){F.show();}else{F.hide();}}H.layout();};var D=/^javascript:/,u=/^mailto:([^?]+)(?:\?(.+))?$/,j=/subject=([^;?:@&=$,\/]*)/,k=/body=([^;?:@&=$,\/]*)/,t=/^#(.*)$/,n=/^((?:http|https|ftp|news):\/\/)?(.*)$/,b=/^(_(?:self|top|parent|blank))$/,a=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,w=/^javascript:([^(]+)\(([^)]+)\)$/;var o=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/;var h=/(?:^|,)([^=]+)=(\d+|yes|no)/gi;var r=function(F,E){var T=(E&&(E.data("cke-saved-href")||E.getAttribute("href")))||"",G,S,Q,H,M={};if((G=T.match(D))){if(p=="encode"){T=T.replace(a,function(ab,ad,ac){return"mailto:"+String.fromCharCode.apply(String,ad.split(","))+(ac&&x(ac));});}else{if(p){T.replace(w,function(ah,aj,ae){if(aj==A.name){M.type="email";var ai=M.email={};var ac=/[^,\s]+/g,ad=/(^')|('$)/g,ab=ae.match(ac),ak=ab.length,ag,al;for(var af=0;af<ak;af++){al=decodeURIComponent(x(ab[af].replace(ad,"")));ag=A.params[af].toLowerCase();ai[ag]=al;}ai.address=[ai.name,ai.domain].join("@");}});}}}if(!M.type){if((Q=T.match(t))){M.type="anchor";M.anchor={};M.anchor.name=M.anchor.id=Q[1];}else{if((S=T.match(u))){var L=T.match(j),N=T.match(k);M.type="email";var O=(M.email={});O.address=S[1];L&&(O.subject=decodeURIComponent(L[1]));N&&(O.body=decodeURIComponent(N[1]));}else{if(T&&(H=T.match(n))){M.type="url";M.url={};M.url.protocol=H[1];M.url.url=H[2];}else{M.type="url";}}}}if(E){var Y=E.getAttribute("target");M.target={};M.adv={};if(!Y){var aa=E.data("cke-pa-onclick")||E.getAttribute("onclick"),U=aa&&aa.match(o);if(U){M.target.type="popup";M.target.name=U[1];var I;while((I=h.exec(U[2]))){if(I[2]=="yes"||I[2]=="1"){M.target[I[1]]=true;}else{if(isFinite(I[2])){M.target[I[1]]=I[2];}}}}}else{var Z=Y.match(b);if(Z){M.target.type=M.target.name=Y;}else{M.target.type="frame";M.target.name=Y;}}var X=this;var P=function(ab,ac){var ad=E.getAttribute(ac);if(ad!==null){M.adv[ab]=ad||"";}};P("advId","id");P("advLangDir","dir");P("advAccessKey","accessKey");M.adv.advName=E.data("cke-saved-name")||E.getAttribute("name")||"";P("advLangCode","lang");P("advTabIndex","tabindex");P("advTitle","title");P("advContentType","type");P("advCSSClasses","class");P("advCharset","charset");P("advStyles","style");}var J=F.document.getElementsByTag("img"),W=new CKEDITOR.dom.nodeList(F.document.$.anchors),K=M.anchors=[];for(var R=0;R<J.count();R++){var V=J.getItem(R);if(V.data("cke-realelement")&&V.data("cke-real-element-type")=="anchor"){K.push(F.restoreRealElement(V));}}for(R=0;R<W.count();R++){K.push(W.getItem(R));}for(R=0;R<K.length;R++){V=K[R];K[R]={name:V.getAttribute("name"),id:V.getAttribute("id")};}this._.selectedElement=E;return M;};var g=function(F,E){if(E[F]){this.setValue(E[F][this.id]||"");}};var m=function(E){return g.call(this,"target",E);};var f=function(E){return g.call(this,"adv",E);};var e=function(F,E){if(!E[F]){E[F]={};}E[F][this.id]=this.getValue()||"";};var B=function(E){return e.call(this,"target",E);};var d=function(E){return e.call(this,"adv",E);};function x(E){return E.replace(/\\'/g,"'");}function z(E){return E.replace(/'/g,"\\$&");}var p=l.config.emailProtection||"";if(p&&p!="encode"){var A={};p.replace(/^([^(]+)\(([^)]+)\)$/,function(E,F,G){A.name=F;A.params=[];G.replace(/[^,\s]+/g,function(H){A.params.push(H);});});}function c(G){var E,F=A.name,K=A.params,I,J;E=[F,"("];for(var H=0;H<K.length;H++){I=K[H].toLowerCase();J=G[I];H>0&&E.push(",");E.push("'",J?z(encodeURIComponent(G[I])):"","'");}E.push(")");return E.join("");}function v(F){var E,I=F.length,G=[];for(var H=0;H<I;H++){E=F.charCodeAt(H);G.push(E);}return"String.fromCharCode("+G.join(",")+")";}var s=l.lang.common,q=l.lang.link;return{title:q.title,minWidth:350,minHeight:230,contents:[{id:"info",label:q.info,title:q.info,elements:[{id:"linkType",type:"select",label:q.type,"default":"url",items:[[q.toUrl,"url"],[q.toAnchor,"anchor"],[q.toEmail,"email"]],onChange:C,setup:function(E){if(E.type){this.setValue(E.type);}},commit:function(E){E.type=this.getValue();}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:s.protocol,"default":"http://",items:[["http://\u200E","http://"],["https://\u200E","https://"],["ftp://\u200E","ftp://"],["news://\u200E","news://"],[q.other,""]],setup:function(E){if(E.url){this.setValue(E.url.protocol||"");}},commit:function(E){if(!E.url){E.url={};}E.url.protocol=this.getValue();}},{type:"text",id:"url",label:s.url,required:true,onLoad:function(){this.allowOnChange=true;},onKeyUp:function(){this.allowOnChange=false;var G=this.getDialog().getContentElement("info","protocol"),E=this.getValue(),F=/^(http|https|ftp|news):\/\/(?=.)/i,I=/^((javascript:)|[#\/\.\?])/i;var H=F.exec(E);if(H){this.setValue(E.substr(H[0].length));G.setValue(H[0].toLowerCase());}else{if(I.test(E)){G.setValue("");}}this.allowOnChange=true;},onChange:function(){if(this.allowOnChange){this.onKeyUp();}},validate:function(){var E=this.getDialog();if(E.getContentElement("info","linkType")&&E.getValueOf("info","linkType")!="url"){return true;}if(this.getDialog().fakeObj){return true;}var F=CKEDITOR.dialog.validate.notEmpty(q.noUrl);return F.apply(this);},setup:function(E){this.allowOnChange=false;if(E.url){this.setValue(E.url.url);}this.allowOnChange=true;},commit:function(E){this.onChange();if(!E.url){E.url={};}E.url.url=this.getValue();this.allowOnChange=false;}}],setup:function(E){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().show();}}},{id:"feindura_link",type:"select",label:feindura_langFile.CKEDITOR_TITLE_LINKS,"default":"",onShow:function(){feindura_pages.each(function(E){if(E.contains(this.getDialog().getContentElement("info","url").getValue())){this.setValue(E[1]);}},this);},items:feindura_pages,onChange:function(){var E=this.getDialog().getContentElement("info","url");E.setValue(this.getValue());}},{type:"button",id:"browse",hidden:"true",filebrowser:"info:url",label:s.browseServer}]},{type:"vbox",id:"anchorOptions",width:260,align:"center",padding:0,children:[{type:"fieldset",id:"selectAnchorText",label:q.selectAnchor,setup:function(E){if(E.anchors.length>0){this.getElement().show();}else{this.getElement().hide();}},children:[{type:"hbox",id:"selectAnchor",children:[{type:"select",id:"anchorName","default":"",label:q.anchorName,style:"width: 100%;",items:[[""]],setup:function(G){this.clear();this.add("");for(var F=0;F<G.anchors.length;F++){if(G.anchors[F].name){this.add(G.anchors[F].name);}}if(G.anchor){this.setValue(G.anchor.name);}var E=this.getDialog().getContentElement("info","linkType");if(E&&E.getValue()=="email"){this.focus();}},commit:function(E){if(!E.anchor){E.anchor={};}E.anchor.name=this.getValue();}},{type:"select",id:"anchorId","default":"",label:q.anchorId,style:"width: 100%;",items:[[""]],setup:function(F){this.clear();this.add("");for(var E=0;E<F.anchors.length;E++){if(F.anchors[E].id){this.add(F.anchors[E].id);}}if(F.anchor){this.setValue(F.anchor.id);}},commit:function(E){if(!E.anchor){E.anchor={};}E.anchor.id=this.getValue();}}],setup:function(E){if(E.anchors.length>0){this.getElement().show();}else{this.getElement().hide();}}}]},{type:"html",id:"noAnchors",style:"text-align: center;",html:'<div role="label" tabIndex="-1">'+CKEDITOR.tools.htmlEncode(q.noAnchors)+"</div>",focus:true,setup:function(E){if(E.anchors.length<1){this.getElement().show();}else{this.getElement().hide();}}}],setup:function(E){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().hide();}}},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:q.emailAddress,required:true,validate:function(){var E=this.getDialog();if(!E.getContentElement("info","linkType")||E.getValueOf("info","linkType")!="email"){return true;}var F=CKEDITOR.dialog.validate.notEmpty(q.noEmail);return F.apply(this);},setup:function(F){if(F.email){this.setValue(F.email.address);}var E=this.getDialog().getContentElement("info","linkType");if(E&&E.getValue()=="email"){this.select();}},commit:function(E){if(!E.email){E.email={};}E.email.address=this.getValue();}},{type:"text",id:"emailSubject",label:q.emailSubject,setup:function(E){if(E.email){this.setValue(E.email.subject);}},commit:function(E){if(!E.email){E.email={};}E.email.subject=this.getValue();}},{type:"textarea",id:"emailBody",label:q.emailBody,rows:3,"default":"",setup:function(E){if(E.email){this.setValue(E.email.body);}},commit:function(E){if(!E.email){E.email={};}E.email.body=this.getValue();}}],setup:function(E){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().hide();}}}]},{id:"target",label:q.target,title:q.target,elements:[{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:s.target,"default":"notSet",style:"width : 100%;",items:[[s.notSet,"notSet"],[q.targetFrame,"frame"],[q.targetPopup,"popup"],[s.targetNew,"_blank"],[s.targetTop,"_top"],[s.targetSelf,"_self"],[s.targetParent,"_parent"]],onChange:y,setup:function(E){if(E.target){this.setValue(E.target.type||"notSet");}y.call(this);},commit:function(E){if(!E.target){E.target={};}E.target.type=this.getValue();}},{type:"text",id:"linkTargetName",label:q.targetFrameName,"default":"",setup:function(E){if(E.target){this.setValue(E.target.name);}},commit:function(E){if(!E.target){E.target={};}E.target.name=this.getValue().replace(/\W/gi,"");}}]},{type:"vbox",width:"100%",align:"center",padding:2,id:"popupFeatures",children:[{type:"fieldset",label:q.popupFeatures,children:[{type:"hbox",children:[{type:"checkbox",id:"resizable",label:q.popupResizable,setup:m,commit:B},{type:"checkbox",id:"status",label:q.popupStatusBar,setup:m,commit:B}]},{type:"hbox",children:[{type:"checkbox",id:"location",label:q.popupLocationBar,setup:m,commit:B},{type:"checkbox",id:"toolbar",label:q.popupToolbar,setup:m,commit:B}]},{type:"hbox",children:[{type:"checkbox",id:"menubar",label:q.popupMenuBar,setup:m,commit:B},{type:"checkbox",id:"fullscreen",label:q.popupFullScreen,setup:m,commit:B}]},{type:"hbox",children:[{type:"checkbox",id:"scrollbars",label:q.popupScrollBars,setup:m,commit:B},{type:"checkbox",id:"dependent",label:q.popupDependent,setup:m,commit:B}]},{type:"hbox",children:[{type:"text",widths:["50%","50%"],labelLayout:"horizontal",label:s.width,id:"width",setup:m,commit:B},{type:"text",labelLayout:"horizontal",widths:["50%","50%"],label:q.popupLeft,id:"left",setup:m,commit:B}]},{type:"hbox",children:[{type:"text",labelLayout:"horizontal",widths:["50%","50%"],label:s.height,id:"height",setup:m,commit:B},{type:"text",labelLayout:"horizontal",label:q.popupTop,widths:["50%","50%"],id:"top",setup:m,commit:B}]}]}]}]},{id:"upload",label:q.upload,title:q.upload,hidden:true,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:s.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:s.uploadSubmit,filebrowser:"info:url","for":["upload","upload"]}]},{id:"advanced",label:q.advanced,title:q.advanced,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",id:"advId",label:q.id,setup:f,commit:d},{type:"select",id:"advLangDir",label:q.langDir,"default":"",style:"width:110px",items:[[s.notSet,""],[q.langDirLTR,"ltr"],[q.langDirRTL,"rtl"]],setup:f,commit:d},{type:"text",id:"advAccessKey",width:"80px",label:q.acccessKey,maxLength:1,setup:f,commit:d}]},{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",label:q.name,id:"advName",setup:f,commit:d},{type:"text",label:q.langCode,id:"advLangCode",width:"110px","default":"",setup:f,commit:d},{type:"text",label:q.tabIndex,id:"advTabIndex",width:"80px",maxLength:5,setup:f,commit:d}]}]},{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:q.advisoryTitle,"default":"",id:"advTitle",setup:f,commit:d},{type:"text",label:q.advisoryContentType,"default":"",id:"advContentType",setup:f,commit:d}]},{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:q.cssClasses,"default":"",id:"advCSSClasses",setup:f,commit:d},{type:"text",label:q.charset,"default":"",id:"advCharset",setup:f,commit:d}]},{type:"hbox",children:[{type:"text",label:q.styles,"default":"",id:"advStyles",setup:f,commit:d}]}]}]}],onShow:function(){this.fakeObj=false;var G=this.getParentEditor(),F=G.getSelection(),E=null;if((E=i.getSelectedLink(G))&&E.hasAttribute("href")){F.selectElement(E);}else{if((E=F.getSelectedElement())&&E.is("img")&&E.data("cke-real-element-type")&&E.data("cke-real-element-type")=="anchor"){this.fakeObj=E;E=G.restoreRealElement(this.fakeObj);F.selectElement(this.fakeObj);}else{E=null;}}this.setupContent(r.apply(this,[G,E]));},onOk:function(){var O={},I=[],af={},ae=this,K=this.getParentEditor();this.commitContent(af);switch(af.type||"url"){case"url":var T=(af.url&&af.url.protocol!=undefined)?af.url.protocol:"http://",L=(af.url&&af.url.url)||"";O["data-cke-saved-href"]=(L.indexOf("/")===0)?L:T+L;break;case"anchor":var ah=(af.anchor&&af.anchor.name),U=(af.anchor&&af.anchor.id);O["data-cke-saved-href"]="#"+(ah||U||"");break;case"email":var G,W=af.email,J=W.address;switch(p){case"":case"encode":var M=encodeURIComponent(W.subject||""),P=encodeURIComponent(W.body||"");var N=[];M&&N.push("subject="+M);P&&N.push("body="+P);N=N.length?"?"+N.join("&"):"";if(p=="encode"){G=["javascript:void(location.href='mailto:'+",v(J)];N&&G.push("+'",z(N),"'");G.push(")");}else{G=["mailto:",J,N];}break;default:var V=J.split("@",2);W.name=V[0];W.domain=V[1];G=["javascript:",c(W)];}O["data-cke-saved-href"]=G.join("");break;}if(af.target){if(af.target.type=="popup"){var Y=["window.open(this.href, '",af.target.name||"","', '"];var ac=["resizable","status","location","toolbar","menubar","fullscreen","scrollbars","dependent"];var ad=ac.length;var S=function(ai){if(af.target[ai]){ac.push(ai+"="+af.target[ai]);}};for(var aa=0;aa<ad;aa++){ac[aa]=ac[aa]+(af.target[ac[aa]]?"=yes":"=no");}S("width");S("left");S("height");S("top");Y.push(ac.join(","),"'); return false;");O["data-cke-pa-onclick"]=Y.join("");I.push("target");}else{if(af.target.type!="notSet"&&af.target.name){O.target=af.target.name;}else{I.push("target");}I.push("data-cke-pa-onclick","onclick");}}if(af.adv){var X=function(ai,aj){var ak=af.adv[ai];if(ak){O[aj]=ak;}else{I.push(aj);}};X("advId","id");X("advLangDir","dir");X("advAccessKey","accessKey");if(af.adv.advName){O.name=O["data-cke-saved-name"]=af.adv.advName;O["class"]=(O["class"]?O["class"]+" ":"")+"cke_anchor";}else{I=I.concat(["data-cke-saved-name","name"]);}X("advLangCode","lang");X("advTabIndex","tabindex");X("advTitle","title");X("advContentType","type");X("advCSSClasses","class");X("advCharset","charset");X("advStyles","style");}O.href=O["data-cke-saved-href"];if(!this._.selectedElement){var ag=K.getSelection(),F=ag.getRanges(true);if(F.length==1&&F[0].collapsed){var R=new CKEDITOR.dom.text(af.type=="email"?af.email.address:O["data-cke-saved-href"],K.document);F[0].insertNode(R);F[0].selectNodeContents(R);ag.selectRanges(F);}var ab=new CKEDITOR.style({element:"a",attributes:O});ab.type=CKEDITOR.STYLE_INLINE;ab.apply(K.document);}else{var E=this._.selectedElement,Z=E.data("cke-saved-href"),Q=E.getHtml();if(CKEDITOR.env.ie&&O.name!=E.getAttribute("name")){var H=new CKEDITOR.dom.element('<a name="'+CKEDITOR.tools.htmlEncode(O.name)+'">',K.document);ag=K.getSelection();E.copyAttributes(H,{name:1});E.moveChildren(H);H.replace(E);E=H;ag.selectElement(E);}E.setAttributes(O);E.removeAttributes(I);if(Z==Q||af.type=="email"&&Q.indexOf("@")!=-1){E.setHtml(af.type=="email"?af.email.address:O["data-cke-saved-href"]);}if(E.getAttribute("name")){E.addClass("cke_anchor");}else{E.removeClass("cke_anchor");}if(this.fakeObj){K.createFakeElement(E,"cke_anchor","anchor").replace(this.fakeObj);}delete this._.selectedElement;}},onLoad:function(){if(!l.config.linkShowAdvancedTab){this.hidePage("advanced");}if(!l.config.linkShowTargetTab){this.hidePage("target");}},onFocus:function(){var E=this.getContentElement("info","linkType"),F;if(E&&E.getValue()=="url"){F=this.getContentElement("info","url");F.select();}}};});